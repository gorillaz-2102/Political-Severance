<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mon Gouvernement Idéal</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&display=swap');

    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9f9f9;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
      height: 140px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    header h1 {
      margin: 0;
      font-size: 2em;
    }

    header p {
      font-size: 0.9em;
      color: #666;
      margin-top: 10px;
    }

    .separateur {
      display: flex;
      align-items: center;
      text-align: center;
      margin: 30px 0;
    }

    .separateur::before,
    .separateur::after {
      content: "";
      flex: 1;
      border-bottom: 1px solid #ccc;
    }

    .separateur:not(:empty)::before {
      margin-right: 10px;
    }

    .separateur:not(:empty)::after {
      margin-left: 10px;
    }

    .separateur span {
      color: #888;
      font-weight: bold;
      font-size: 0.9em;
      text-transform: uppercase;
    }

    #fonctions,
    #fonctions-ministeres {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }

    .fonction {
      display: flex;
      height: 140px;
      border: 1px solid #45a049;
      border-radius: 8px;
      overflow: hidden;
      background: white;
    }

    .fonction.large {
      width: 360px;
    }

    .fonction.small {
      width: 310px;
    }

    .info {
      flex: 1;
      padding: 10px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .titre {
      font-weight: bold;
      font-size: 0.9em;
    }

    .nom-personne {
      color: #002366;
      font-size: 1.6em;
      font-weight: bold;
      font-family: 'Roboto Condensed', sans-serif;
      line-height: 1em;
      margin-top: 6px;
      margin-bottom: 6px;
    }

    .image-zone {
      width: 120px;
      height: 100%;
      background-color: #eee;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s ease;
      position: relative;
    }

    .image-zone img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transform: translateX(15px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    .image-zone.loaded img {
      opacity: 1;
      transform: translateX(0);
    }

    .image-zone span {
      font-size: 24px;
      color: #666;
      transition: opacity 0.3s ease;
    }

    input[type="text"] {
      margin-bottom: 6px;
    }

    button {
      margin-top: 4px;
    }

    #suggestions {
      position: absolute;
      background: white;
      border: 1px solid #ccc;
      list-style: none;
      padding: 0;
      margin: 0;
      z-index: 1000;
    }

    #suggestions li:hover {
      background-color: #f0f0f0;
    }

    #suggestions li {
      display: flex;
      align-items: center;
      padding: 5px;
      cursor: pointer;
    }

    #suggestions li img {
      width: 30px;
      height: 30px;
      object-fit: cover;
      border-radius: 50%;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Mon Gouvernement Idéal</h1>
      <p>Recrute ton équipe de rêve sans contraintes ni jugements</p>
    </header>

    <ul id="suggestions"></ul>
    <div id="fonctions"></div>

    <div class="separateur"><span>Ministères</span></div>
    <div id="fonctions-ministeres"></div>
  </div>

  <script>
      const fonctions = [
    { nom: "Président de la République", personne: null },
    { nom: "Premier Ministre", personne: null },
    { nom: "Intérieur", personne: null },
    { nom: "Transition écologique et solidaire", personne: null },
    { nom: "Justice", personne: null },
    { nom: "Europe et aff. étrangères", personne: null },
    { nom: "Armées", personne: null },
    { nom: "Cohésion des territoires", personne: null },
    { nom: "Solidarités & Santé", personne: null },
    { nom: "Economie & Finances", personne: null },
    { nom: "Culture", personne: null },
    { nom: "Travail", personne: null },
    { nom: "Education Nationale", personne: null },
    { nom: "Agriculture & Alimentation", personne: null },
    { nom: "Action & Comptes Publics", personne: null },
    { nom: "Enseignement Sup., Recherche & Innov.", personne: null },
    { nom: "Outre-mer", personne: null },
    { nom: "Sports", personne: null },
    { nom: "Secrétariat d'État Egalité H/F", personne: null },
  ];

  function afficherFonctions() {
    const containerTop = document.getElementById('fonctions');
    const containerBottom = document.getElementById('fonctions-ministeres');
    containerTop.innerHTML = '';
    containerBottom.innerHTML = '';

    fonctions.forEach((f, index) => {
      const div = document.createElement('div');
      div.className = 'fonction';
      div.classList.add(index < 2 ? 'large' : 'small');

      const infoDiv = document.createElement('div');
      infoDiv.className = 'info';

      const titre = document.createElement('div');
      titre.className = 'titre';
      titre.textContent = f.nom;
      infoDiv.appendChild(titre);

      const imageDiv = document.createElement('div');
      imageDiv.className = 'image-zone';

      if (f.personne) {
        const wikiUrl = `https://fr.wikipedia.org/wiki/${encodeURIComponent(f.personne.nom.replace(/ /g, "_"))}`;
        const nomLink = document.createElement('a');
        nomLink.className = 'nom-personne';
        nomLink.href = wikiUrl;
        nomLink.target = "_blank"; // ouvre dans un nouvel onglet
        nomLink.textContent = f.personne.nom;
        infoDiv.appendChild(nomLink);

        const boutonChanger = document.createElement('button');
        boutonChanger.textContent = "Changer";
        boutonChanger.onclick = () => {
          f.personne = null;
          afficherFonctions();
        };
        infoDiv.appendChild(boutonChanger);

        if (f.personne.image) {
          const img = document.createElement('img');
          img.src = f.personne.image;
          img.alt = f.personne.nom;
          img.onload = () => imageDiv.classList.add('loaded');
          imageDiv.innerHTML = "";
          imageDiv.appendChild(img);
        } else {
          imageDiv.innerHTML = "<span>?</span>";
        }
      } else {
        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = "Ajouter un nom";
        input.autocomplete = "off";

        const boutonRecruter = document.createElement('button');
        boutonRecruter.textContent = "Changer";
        boutonRecruter.disabled = true;

        const suggestions = document.getElementById('suggestions');

        input.addEventListener("input", async () => {
          const query = input.value.trim();
          suggestions.innerHTML = "";
          boutonRecruter.disabled = true;
          if (query.length < 2) return;

          async function rechercherWiki(lang, query) {
            const res = await fetch(`https://${lang}.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=pageimages|pageprops&piprop=thumbnail&pithumbsize=100&generator=prefixsearch&gpssearch=${encodeURIComponent(query)}&gpslimit=5`);
            const data = await res.json();
            return data.query ? Object.values(data.query.pages) : [];
          }

          async function chercherImageWikidata(qid) {
            const res = await fetch(`https://www.wikidata.org/wiki/Special:EntityData/${qid}.json`);
            const data = await res.json();
            const claims = data.entities[qid].claims;
            const imageClaim = claims && claims.P18 ? claims.P18[0].mainsnak.datavalue.value : null;

            if (imageClaim) {
              const filename = imageClaim.replace(/ /g, '_');
              const md5 = await crypto.subtle.digest('MD5', new TextEncoder().encode(filename));
              const hashArray = Array.from(new Uint8Array(md5)).map(b => b.toString(16).padStart(2, '0'));
              const hash = hashArray.join('');
              return `https://upload.wikimedia.org/wikipedia/commons/${hash[0]}/${hash.slice(0,2)}/${filename}`;
            }

            return null;
          }

          const allPages = await rechercherWiki("fr", query);
          const pages = allPages.length > 0 ? allPages : await rechercherWiki("en", query);

          for (const page of pages) {
            const li = document.createElement("li");
            const span = document.createElement("span");
            span.textContent = page.title;

            let imgSrc = page.thumbnail ? page.thumbnail.source : "";

            if (!imgSrc || imgSrc.includes("No_image") || imgSrc.includes("Image_not_available")) {
              const qid = page.pageprops ? page.pageprops.wikibase_item : null;
              if (qid) {
                imgSrc = await chercherImageWikidata(qid) || "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/No_image_3x4.svg/50px-No_image_3x4.svg.png";
              }
            }

            const img = document.createElement("img");
            img.src = imgSrc;
            img.alt = "";
            img.style.width = "30px";
            img.style.height = "30px";
            img.style.objectFit = "cover";
            img.style.borderRadius = "50%";
            img.style.marginRight = "10px";

            li.appendChild(img);
            li.appendChild(span);

            li.onclick = () => {
              f.personne = {
                nom: page.title,
                image: img.src
              };
              suggestions.innerHTML = "";
              afficherFonctions();
            };

            suggestions.appendChild(li);
          }

          const rect = input.getBoundingClientRect();
          suggestions.style.left = rect.left + "px";
          suggestions.style.top = (window.scrollY + rect.bottom) + "px";
          suggestions.style.width = rect.width + "px";
        });

        document.addEventListener("click", (e) => {
          if (!suggestions.contains(e.target) && e.target !== input) {
            suggestions.innerHTML = "";
          }
        });

        infoDiv.appendChild(input);
        infoDiv.appendChild(boutonRecruter);
        imageDiv.innerHTML = "<span>?</span>";
      }

      div.appendChild(infoDiv);
      div.appendChild(imageDiv);

      if (index < 2) {
        containerTop.appendChild(div);
      } else {
        containerBottom.appendChild(div);
      }
    });
  }

  // Fonction pour afficher les statistiques
  function genererTableauStats() {
    const stats = {};

    fonctions.forEach(f => {
      if (f.personne) {
        const nom = f.personne.nom;
        if (!stats[nom]) {
          stats[nom] = {
            count: 0,
            postes: []
          };
        }
        stats[nom].count += 1;
        stats[nom].postes.push(f.nom);
      }
    });

    const filteredStats = Object.entries(stats).filter(([_, data]) => data.count >= 2);
    if (filteredStats.length === 0) return;

    const container = document.getElementById('stats-container');
    container.innerHTML = ""; // On vide avant de reconstruire

    const title = document.createElement('h2');
    title.textContent = "Statistiques des personnes sélectionnées plusieurs fois";
    container.appendChild(title);

    const table = document.createElement('table');
    table.style.borderCollapse = 'collapse';
    table.style.width = '100%';
    table.style.marginTop = '10px';

    const headerRow = table.insertRow();
    ['Nom', 'Nombre de sélections', 'Postes'].forEach(text => {
      const th = document.createElement('th');
      th.textContent = text;
      th.style.border = '1px solid #ccc';
      th.style.padding = '8px';
      th.style.backgroundColor = '#f0f0f0';
      headerRow.appendChild(th);
    });

    filteredStats.forEach(([nom, data]) => {
      const row = table.insertRow();
      const cellNom = row.insertCell();
      cellNom.textContent = nom;

      const cellCount = row.insertCell();
      cellCount.textContent = data.count;

      const cellPostes = row.insertCell();
      cellPostes.textContent = data.postes.join(", ");

      [cellNom, cellCount, cellPostes].forEach(cell => {
        cell.style.border = '1px solid #ccc';
        cell.style.padding = '8px';
      });
    });

    container.appendChild(table);
  }

  document.getElementById('valider-btn').addEventListener('click', () => {
    genererTableauStats();
  });

  afficherFonctions();
</script>

  </script>
</body>
</html>
