<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Attribution de Fonctions</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      background-color: #f9f9f9;
    }

    h1 {
      text-align: center;
      width: 100%;
    }

    #fonctions {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 900px;
      gap: 20px;
    }

    .fonction {
      width: 400px;
      display: flex;
      border: 1px solid #45a049;
      border-radius: 8px;
      overflow: hidden;
      background: white;
    }

    .info {
      flex: 1;
      padding: 10px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .titre {
      font-weight: bold;
    }

    .nom-personne {
      color: #002366; /* Bleu roi */
      font-size: 1.6em;
      line-height: 1em;
      margin-top: 6px;
      margin-bottom: 6px;
    }

    .image-zone {
      width: 80px;
      background-color: #eee;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .image-zone img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .image-zone span {
      font-size: 24px;
      color: #666;
    }

    input[type="text"] {
      margin-bottom: 6px;
    }

    button {
      margin-top: 4px;
    }

    #suggestions li:hover {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>
  <div style="width: 100%;">
    <h1>Liste des fonctions</h1>
    <ul id="suggestions" style="position:absolute; background:white; border:1px solid #ccc; list-style:none; padding:0; margin:0; z-index:1000;"></ul>
    <div id="fonctions"></div>
  </div>

  <script>
    const fonctions = [
      { nom: "Président", personne: null },
      { nom: "1er Ministre", personne: null },
      { nom: "Garde des sceaux", personne: null },
      { nom: "Ministre de la Culture", personne: null },
      { nom: "Ministre de l'Écologie", personne: null },
      { nom: "Ministre de l'Industrie", personne: null },
      { nom: "Ministre des Armées", personne: null },
      { nom: "Ministre de l'Éducation Nationale", personne: null },
    ];

    function afficherFonctions() {
      const container = document.getElementById('fonctions');
      container.innerHTML = '';

      fonctions.forEach((f, index) => {
        const div = document.createElement('div');
        div.className = 'fonction';

        const infoDiv = document.createElement('div');
        infoDiv.className = 'info';

        const titre = document.createElement('div');
        titre.className = 'titre';
        titre.textContent = f.nom;

        infoDiv.appendChild(titre);

        if (f.personne) {
          const nomDiv = document.createElement('div');
          nomDiv.className = 'nom-personne';
          nomDiv.textContent = f.personne.nom;
          infoDiv.appendChild(nomDiv);

          const boutonLiberer = document.createElement('button');
          boutonLiberer.textContent = "Libérer";
          boutonLiberer.onclick = () => {
            f.personne = null;
            afficherFonctions();
          };
          infoDiv.appendChild(boutonLiberer);
        } else {
          const input = document.createElement('input');
          input.type = 'text';
          input.placeholder = "Ajouter un nom";
          input.autocomplete = "off";

          const suggestions = document.getElementById('suggestions');

          input.addEventListener("input", async () => {
            const query = input.value.trim();
            suggestions.innerHTML = "";
            if (query.length < 2) return;

            const res = await fetch(`https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=pageimages&piprop=thumbnail&pithumbsize=100&generator=prefixsearch&gpssearch=${encodeURIComponent(query)}&gpslimit=5`);
            const data = await res.json();
            if (!data.query) return;

            const pages = Object.values(data.query.pages);

            pages.forEach(page => {
              const li = document.createElement("li");
              li.style.display = "flex";
              li.style.alignItems = "center";
              li.style.padding = "5px";
              li.style.cursor = "pointer";

              const img = document.createElement("img");
              img.src = page.thumbnail ? page.thumbnail.source : "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/No_image_3x4.svg/50px-No_image_3x4.svg.png";
              img.alt = "";
              img.style.marginRight = "10px";
              img.style.width = "30px";
              img.style.height = "30px";
              img.style.objectFit = "cover";
              img.style.borderRadius = "50%";

              const span = document.createElement("span");
              span.textContent = page.title;

              li.appendChild(img);
              li.appendChild(span);

              li.onclick = () => {
                input.value = page.title;
                input.dataset.image = page.thumbnail ? page.thumbnail.source : "";
                suggestions.innerHTML = "";
              };

              suggestions.appendChild(li);
            });

            const rect = input.getBoundingClientRect();
            suggestions.style.left = rect.left + "px";
            suggestions.style.top = (window.scrollY + rect.bottom) + "px";
            suggestions.style.width = rect.width + "px";
          });

          document.addEventListener("click", (e) => {
            if (!suggestions.contains(e.target) && e.target !== input) {
              suggestions.innerHTML = "";
            }
          });

          const boutonAjouter = document.createElement('button');
          boutonAjouter.textContent = "Recruter";
          boutonAjouter.onclick = () => {
            const nom = input.value.trim();
            if (!nom) return;

            f.personne = {
              nom: nom,
              image: input.dataset.image || null
            };
            afficherFonctions();
          };

          infoDiv.appendChild(input);
          infoDiv.appendChild(boutonAjouter);
        }

        const imageDiv = document.createElement('div');
        imageDiv.className = 'image-zone';

        if (f.personne && f.personne.image) {
          const img = document.createElement('img');
          img.src = f.personne.image;
          img.alt = f.personne.nom;
          imageDiv.innerHTML = "";
          imageDiv.appendChild(img);
        } else {
          const span = document.createElement('span');
          span.textContent = "?";
          imageDiv.innerHTML = "";
          imageDiv.appendChild(span);
        }

        div.appendChild(infoDiv);
        div.appendChild(imageDiv);
        container.appendChild(div);
      });
    }

    afficherFonctions();
  </script>
</body>
</html>
