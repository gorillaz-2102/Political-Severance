<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Créer son Gouvernement</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f6f6f6;
      margin: 0;
      padding: 0;
    }

    h1 {
      text-align: center;
      margin: 30px 0;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
    }

    #fonctions, #fonctions-ministeres {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }

    .fonction {
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      width: 250px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .fonction.large {
      width: 100%;
    }

    .info {
      margin-bottom: 10px;
    }

    .titre {
      font-weight: bold;
      margin-bottom: 8px;
    }

    input[type="text"] {
      padding: 6px;
      width: 100%;
      margin-bottom: 6px;
    }

    button {
      padding: 6px 12px;
      margin-top: 6px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    button:disabled {
      background-color: #ccc;
    }

    .image-zone {
      width: 100%;
      height: 180px;
      background-color: #eee;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      overflow: hidden;
    }

    .image-zone img {
      max-width: 100%;
      max-height: 100%;
    }

    table {
      width: 90%;
      margin: 30px auto;
      border-collapse: collapse;
      background-color: white;
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: #f1f1f1;
    }

    .nom-personne {
      display: block;
      margin-top: 4px;
      color: #007BFF;
      text-decoration: none;
    }

    .nom-personne:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>Crée ton propre gouvernement</h1>

  <div class="container">
    <div id="fonctions"></div>
    <hr style="margin: 40px 0;">
    <div id="fonctions-ministeres"></div>
  </div>

  <script>
const fonctions = [
  { nom: "Président de la République", personne: null },
  { nom: "Premier Ministre", personne: null },
  { nom: "Intérieur", personne: null },
  { nom: "Transition écologique et solidaire", personne: null },
  { nom: "Justice", personne: null },
  { nom: "Europe et aff. étrangères", personne: null },
  { nom: "Armées", personne: null },
  { nom: "Cohésion des territoires", personne: null },
  { nom: "Solidarités & Santé", personne: null },
  { nom: "Economie & Finances", personne: null },
  { nom: "Culture", personne: null },
  { nom: "Travail", personne: null },
  { nom: "Education Nationale", personne: null },
  { nom: "Agriculture & Alimentation", personne: null },
  { nom: "Action & Comptes Publics", personne: null },
  { nom: "Enseignement Sup., Recherche & Innov.", personne: null },
  { nom: "Outre-mer", personne: null },
  { nom: "Sports", personne: null },
  { nom: "Secrétariat d'État Egalité H/F", personne: null },
];

function afficherFonctions() {
  const containerTop = document.getElementById('fonctions');
  const containerBottom = document.getElementById('fonctions-ministeres');
  containerTop.innerHTML = '';
  containerBottom.innerHTML = '';

  fonctions.forEach((f, index) => {
    const div = document.createElement('div');
    div.className = 'fonction';
    div.classList.add(index < 2 ? 'large' : 'small');

    const infoDiv = document.createElement('div');
    infoDiv.className = 'info';

    const titre = document.createElement('div');
    titre.className = 'titre';
    titre.textContent = f.nom;
    infoDiv.appendChild(titre);

    const imageDiv = document.createElement('div');
    imageDiv.className = 'image-zone';

    if (f.personne) {
      const wikiUrl = `https://fr.wikipedia.org/wiki/${encodeURIComponent(f.personne.nom.replace(/ /g, "_"))}`;
      const nomLink = document.createElement('a');
      nomLink.className = 'nom-personne';
      nomLink.href = wikiUrl;
      nomLink.target = "_blank";
      nomLink.textContent = f.personne.nom;
      infoDiv.appendChild(nomLink);

      const boutonChanger = document.createElement('button');
      boutonChanger.textContent = "Changer";
      boutonChanger.onclick = () => {
        f.personne = null;
        afficherFonctions();
      };
      infoDiv.appendChild(boutonChanger);

      if (f.personne.image) {
        const img = document.createElement('img');
        img.src = f.personne.image;
        img.alt = f.personne.nom;
        img.onload = () => imageDiv.classList.add('loaded');
        imageDiv.innerHTML = "";
        imageDiv.appendChild(img);
      } else {
        imageDiv.innerHTML = "<span>?</span>";
      }
    } else {
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = "Ajouter un nom";
      input.autocomplete = "off";

      const bouton = document.createElement('button');
      bouton.textContent = "OK";
      bouton.disabled = true;

      input.addEventListener('input', async () => {
        bouton.disabled = input.value.trim().length < 2;
      });

      bouton.onclick = async () => {
        const nom = input.value.trim();
        const wiki = await chercherWikipedia(nom);
        f.personne = {
          nom: nom,
          image: wiki.image
        };
        afficherFonctions();
      };

      infoDiv.appendChild(input);
      infoDiv.appendChild(bouton);
      imageDiv.innerHTML = "<span>?</span>";
    }

    div.appendChild(infoDiv);
    div.appendChild(imageDiv);

    if (index < 2) {
      containerTop.appendChild(div);
    } else {
      containerBottom.appendChild(div);
    }
  });

  afficherBoutonValidation();
}

async function chercherWikipedia(nom) {
  const pageName = encodeURIComponent(nom);
  const url = `https://fr.wikipedia.org/w/api.php?action=query&origin=*&format=json&prop=pageimages|pageprops&piprop=thumbnail&pithumbsize=200&titles=${pageName}`;
  const res = await fetch(url);
  const data = await res.json();
  const pages = data.query.pages;
  const page = Object.values(pages)[0];
  const image = page?.thumbnail?.source || "";
  return { image };
}

function afficherBoutonValidation() {
  let boutonValider = document.getElementById("valider-gouvernement");
  if (!boutonValider) {
    boutonValider = document.createElement("button");
    boutonValider.id = "valider-gouvernement";
    boutonValider.textContent = "Valider le gouvernement";
    boutonValider.style.display = "block";
    boutonValider.style.margin = "40px auto";
    boutonValider.style.padding = "10px 20px";
    boutonValider.style.fontSize = "1em";
    document.querySelector(".container").appendChild(boutonValider);
    boutonValider.onclick = afficherStats;
  }
}

function afficherStats() {
  const map = new Map();

  fonctions.forEach(f => {
    if (f.personne) {
      const nom = f.personne.nom;
      if (!map.has(nom)) {
        map.set(nom, []);
      }
      map.get(nom).push(f.nom);
    }
  });

  const doublons = Array.from(map.entries()).filter(([_, postes]) => postes.length > 1);

  let tableau = document.getElementById("stats-gouvernement");
  if (tableau) tableau.remove();

  if (doublons.length > 0) {
    tableau = document.createElement("table");
    tableau.id = "stats-gouvernement";
    tableau.style.margin = "40px auto";
    tableau.style.borderCollapse = "collapse";
    tableau.style.width = "80%";

    const thead = document.createElement("thead");
    thead.innerHTML = "<tr><th>Nom</th><th>Nombre de postes</th><th>Postes</th></tr>";
    tableau.appendChild(thead);

    const tbody = document.createElement("tbody");

    doublons.forEach(([nom, postes]) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${nom}</td><td>${postes.length}</td><td>${postes.join(", ")}</td>`;
      tbody.appendChild(tr);
    });

    tableau.appendChild(tbody);
    document.querySelector(".container").appendChild(tableau);
  } else {
    alert("Aucune personne sélectionnée plusieurs fois.");
  }
}

afficherFonctions();
</script>
</body>
</html>
