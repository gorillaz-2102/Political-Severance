<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Créer un Gouvernement</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f9f9f9;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
    }
    .fonction {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 15px;
  background: white;
  border-radius: 8px;
  border: 1px solid #ddd;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  width: 100%;
  margin-bottom: 16px;
}

.fonction .titre {
  font-weight: bold;
  font-size: 1em;
  margin-bottom: 6px;
}

.fonction .info {
  display: flex;
  flex-direction: column;
  flex: 1;
  margin-right: 10px;
}

.fonction input[type="text"] {
  padding: 8px;
  font-size: 1em;
  border-radius: 4px;
  border: 1px solid #ccc;
  width: 100%;
  box-sizing: border-box;
}

.fonction .image-zone {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background-color: #eee;
}

    .suggestions {
      position: absolute;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      z-index: 1000;
      list-style: none;
      margin: 0;
      padding: 0;
      max-height: 150px;
      overflow-y: auto;
      width: 100%;
    }
    .suggestions li {
      display: flex;
      align-items: center;
      padding: 5px;
      cursor: pointer;
    }
    .suggestions li:hover {
      background-color: #f0f0f0;
    }
    .nom-personne {
      display: block;
      margin-top: 5px;
      text-decoration: none;
      color: #2a7ae2;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Créer votre Gouvernement</h1>
    <div id="fonctions"></div>
    <div id="fonctions-ministeres"></div>
    <button onclick="validerGouvernement()">Valider le Gouvernement</button>
    <div id="stats"></div>
  </div>

  <script>
    const fonctions = [
      { nom: "Président de la République", personne: null },
      { nom: "Premier Ministre", personne: null },
      { nom: "Intérieur", personne: null },
      { nom: "Transition écologique et solidaire", personne: null },
      { nom: "Justice", personne: null },
      { nom: "Europe et aff. étrangères", personne: null },
      { nom: "Armées", personne: null },
      { nom: "Cohésion des territoires", personne: null },
      { nom: "Solidarités & Santé", personne: null },
      { nom: "Economie & Finances", personne: null },
      { nom: "Culture", personne: null },
      { nom: "Travail", personne: null },
      { nom: "Education Nationale", personne: null },
      { nom: "Agriculture & Alimentation", personne: null },
      { nom: "Action & Comptes Publics", personne: null },
      { nom: "Enseignement Sup., Recherche & Innov.", personne: null },
      { nom: "Outre-mer", personne: null },
      { nom: "Sports", personne: null },
      { nom: "Secrétariat d'État Egalité H/F", personne: null },
    ];

    function afficherFonctions() {
      const container = document.getElementById('fonctions');
      const containerMin = document.getElementById('fonctions-ministeres');
      container.innerHTML = '';
      containerMin.innerHTML = '';

      fonctions.forEach((f, i) => {
        const div = document.createElement('div');
        div.className = 'fonction ' + (i < 2 ? 'large' : 'small');

        const info = document.createElement('div');
        info.className = 'info';

        const titre = document.createElement('div');
        titre.textContent = f.nom;
        info.appendChild(titre);

        const imageZone = document.createElement('div');
        imageZone.className = 'image-zone';

        if (f.personne) {
          const wikiUrl = `https://fr.wikipedia.org/wiki/${encodeURIComponent(f.personne.nom.replace(/ /g, '_'))}`;
          const a = document.createElement('a');
          a.href = wikiUrl;
          a.target = '_blank';
          a.className = 'nom-personne';
          a.textContent = f.personne.nom;
          info.appendChild(a);

          const btn = document.createElement('button');
          btn.textContent = 'Changer';
          btn.onclick = () => { f.personne = null; afficherFonctions(); };
          info.appendChild(btn);

          const img = document.createElement('img');
          img.src = f.personne.image;
          imageZone.appendChild(img);
        } else {
          const input = document.createElement('input');
          input.type = 'text';
          input.placeholder = 'Nom...';

          const suggestionList = document.createElement('ul');
          suggestionList.className = 'suggestions';
          info.appendChild(suggestionList);

          input.addEventListener('input', async () => {
            const val = input.value.trim();
            suggestionList.innerHTML = '';
            if (val.length < 2) return;

            const res = await fetch(`https://fr.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=pageimages|pageprops&piprop=thumbnail&pithumbsize=100&generator=prefixsearch&gpssearch=${encodeURIComponent(val)}&gpslimit=5`);
            const data = await res.json();
            const pages = data.query ? Object.values(data.query.pages) : [];

            pages.forEach(page => {
              const li = document.createElement('li');
              const img = document.createElement('img');
              img.src = page.thumbnail ? page.thumbnail.source : '';
              img.style.width = '30px';
              img.style.height = '30px';
              img.style.borderRadius = '50%';
              img.style.marginRight = '10px';
              const span = document.createElement('span');
              span.textContent = page.title;
              li.appendChild(img);
              li.appendChild(span);
              li.onclick = () => {
                f.personne = { nom: page.title, image: img.src };
                afficherFonctions();
              };
              suggestionList.appendChild(li);
            });
          });

          info.appendChild(input);
        }

        div.appendChild(info);
        div.appendChild(imageZone);
        if (i < 2) {
          container.appendChild(div);
        } else {
          containerMin.appendChild(div);
        }
      });
    }

    function validerGouvernement() {
      const statsDiv = document.getElementById('stats');
      const comptage = {};
      fonctions.forEach(f => {
        if (f.personne) {
          if (!comptage[f.personne.nom]) {
            comptage[f.personne.nom] = { nom: f.personne.nom, image: f.personne.image, fonctions: [] };
          }
          comptage[f.personne.nom].fonctions.push(f.nom);
        }
      });

      const personnesRedondantes = Object.values(comptage).filter(p => p.fonctions.length > 1);

      let html = '';
      if (personnesRedondantes.length > 0) {
        html += '<h2>Personnes sélectionnées plusieurs fois</h2><table><thead><tr><th>Nom</th><th>Fonctions</th></tr></thead><tbody>';
        personnesRedondantes.forEach(p => {
          html += `<tr><td>${p.nom}</td><td>${p.fonctions.join(', ')}</td></tr>`;
        });
        html += '</tbody></table>';
      }

      html += '<h2>Composition du Gouvernement</h2><table><thead><tr><th>Fonction</th><th>Nom</th></tr></thead><tbody>';
      fonctions.forEach(f => {
        const wikiUrl = f.personne ? `https://fr.wikipedia.org/wiki/${encodeURIComponent(f.personne.nom.replace(/ /g, '_'))}` : '';
        html += `<tr><td>${f.nom}</td><td>${f.personne ? `<a href="${wikiUrl}" target="_blank">${f.personne.nom}</a>` : ''}</td></tr>`;
      });
      html += '</tbody></table>';

      statsDiv.innerHTML = html;
    }

    afficherFonctions();
  </script>
</body>
</html>
