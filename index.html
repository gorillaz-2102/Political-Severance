<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mon Gouvernement Idéal</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f7f7f7;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
    }

    header h1 {
      font-size: 2em;
      margin-bottom: 10px;
    }

    header p {
      font-size: 1em;
      color: #666;
    }

    .fonction {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #fff;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      margin-bottom: 16px;
      border-left: 4px solid #4caf50;
    }

    .info {
      display: flex;
      flex-direction: column;
      flex: 1;
      margin-right: 15px;
    }

    .titre {
      font-weight: bold;
      font-size: 1em;
      margin-bottom: 8px;
    }

    input[type="text"] {
      padding: 10px;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 100%;
      box-sizing: border-box;
    }

    .photo {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background-color: #ddd;
      background-size: cover;
      background-position: center;
      flex-shrink: 0;
    }

    .suggestions {
      position: absolute;
      background: white;
      border: 1px solid #ccc;
      list-style: none;
      padding: 0;
      margin: 4px 0 0;
      z-index: 1000;
      width: 100%;
      max-height: 200px;
      overflow-y: auto;
      border-radius: 6px;
    }

    .suggestions li {
      display: flex;
      align-items: center;
      padding: 8px;
      cursor: pointer;
    }

    .suggestions li:hover {
      background-color: #f0f0f0;
    }

    .suggestions img {
      width: 32px;
      height: 32px;
      object-fit: cover;
      border-radius: 50%;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Mon Gouvernement Idéal</h1>
      <p>Recrute ton équipe de rêve sans contraintes ni jugements</p>
    </header>
    <div id="fonctions"></div>
  </div>

  <script>
    const fonctions = [
      "Président de la République", "Premier Ministre", "Ministre de l'Intérieur",
      "Ministre de la Justice", "Ministre de l'Écologie", "Ministre des Affaires Étrangères",
      "Ministre des Armées", "Ministre de la Santé", "Ministre de l'Économie",
      "Ministre de la Culture", "Ministre du Travail", "Ministre de l'Éducation",
      "Ministre de l'Agriculture", "Ministre des Outre-Mer", "Ministre des Sports",
      "Ministre de la Recherche", "Secrétaire d'État à l'Égalité"
    ];

    const container = document.getElementById('fonctions');

    fonctions.forEach(fonction => {
      const div = document.createElement('div');
      div.className = 'fonction';

      const infoDiv = document.createElement('div');
      infoDiv.className = 'info';

      const titre = document.createElement('div');
      titre.className = 'titre';
      titre.textContent = fonction;

      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Nom de la personne';

      const suggestions = document.createElement('ul');
      suggestions.className = 'suggestions';
      suggestions.style.display = 'none';

      const photo = document.createElement('div');
      photo.className = 'photo';

      input.addEventListener('input', async () => {
        const query = input.value.trim();
        suggestions.innerHTML = '';
        suggestions.style.display = 'none';
        if (query.length < 2) return;

        const pages = await rechercherWikipedia(query);
        if (pages.length > 0) {
          pages.forEach(page => {
            const li = document.createElement('li');
            const img = document.createElement('img');
            const name = document.createElement('span');

            name.textContent = page.title;
            img.src = page.image;
            li.appendChild(img);
            li.appendChild(name);

            li.onclick = () => {
              input.value = page.title;
              photo.style.backgroundImage = `url(${page.image})`;
              suggestions.innerHTML = '';
              suggestions.style.display = 'none';
            };

            suggestions.appendChild(li);
          });
          suggestions.style.display = 'block';
        }
      });

      document.addEventListener('click', (e) => {
        if (!div.contains(e.target)) {
          suggestions.innerHTML = '';
          suggestions.style.display = 'none';
        }
      });

      infoDiv.appendChild(titre);
      infoDiv.appendChild(input);
      infoDiv.appendChild(suggestions);

      div.appendChild(infoDiv);
      div.appendChild(photo);
      container.appendChild(div);
    });

    async function rechercherWikipedia(query) {
      async function fetchFrom(lang) {
        const url = `https://${lang}.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=pageimages|pageprops&piprop=thumbnail&pithumbsize=100&generator=prefixsearch&gpssearch=${encodeURIComponent(query)}&gpslimit=5`;
        const res = await fetch(url);
        const data = await res.json();
        if (data.query) return Object.values(data.query.pages);
        return [];
      }

      const frResults = await fetchFrom('fr');
      const pages = frResults.length > 0 ? frResults : await fetchFrom('en');

      return Promise.all(pages.map(async page => {
        let img = page.thumbnail ? page.thumbnail.source : "";
        if (!img || img.includes("No_image")) {
          const qid = page.pageprops?.wikibase_item;
          if (qid) img = await getImageFromWikidata(qid);
        }
        if (!img) img = "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/No_image_3x4.svg/50px-No_image_3x4.svg.png";
        return { title: page.title, image: img };
      }));
    }

    async function getImageFromWikidata(qid) {
      const res = await fetch(`https://www.wikidata.org/wiki/Special:EntityData/${qid}.json`);
      const data = await res.json();
      const claims = data.entities[qid].claims;
      const imageClaim = claims?.P18?.[0]?.mainsnak?.datavalue?.value;
      if (!imageClaim) return null;

      const filename = imageClaim.replace(/ /g, '_');
      const md5 = await crypto.subtle.digest('MD5', new TextEncoder().encode(filename));
      const hashArray = Array.from(new Uint8Array(md5)).map(b => b.toString(16).padStart(2, '0'));
      const hash = hashArray.join('');
      return `https://upload.wikimedia.org/wikipedia/commons/${hash[0]}/${hash.slice(0,2)}/${filename}`;
    }
  </script>
</body>
</html>
